<% layout('layout/boilerplate') %>

  <link rel="stylesheet" href="/stylesheets/stars.css">
  


  <div class="container mb-5">


    <h5 class="text-capitalize" id="camp-title-head">
      <%= campground.title %>
    </h5>



    <div class="row mt-4">
 
      <div class="col-md-7">



        <div class="card mb-3 shadow-sm ">

          <div id="carouselExampleFade" class="carousel slide carousel-fade" data-bs-ride="carousel">
            <div class="carousel-inner">

              <% for(let i=0 ; i<campground.images.length;i++ ){ %>

                <% if(i==0){ %>
                  <div class="carousel-item active">
                    <img src="<%= campground.images[i].url %>" loading="lazy" class="d-block w-100 show-card-img"
                      alt="...">
                  </div>
                  <% } else {%>
                    <div class="carousel-item">
                      <img src="<%=campground.images[i].url%>" class="d-block w-100 show-card-img" alt="...">
                    </div>
                    <% } %>





                      <% if(campground.images.length>1){ %>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleFade"
                          data-bs-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleFade"
                          data-bs-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="visually-hidden">Next</span>
                        </button>
                        <% } %>

                          <% } %>
            </div>



          </div>


          <div class="card-body">
            <h5 class="card-title">
              <%= campground.title %>


              <%  if( currentUser && campground.author.equals(currentUser._id))  {%>


                <div class="btn-group dropup float-end ">


                  <a type="button" class="reset dropdown-toggle" id="menu-icon" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    <small><i class="fas fa-ellipsis-v"></i></small>
                    <!-- menu icon -->
                  </a>

                  <ul class="dropdown-menu ">

                    <li>
                      <a href="<%=campground._id%>/edit" class="card-link btn reset mb-2 ms-1">Edit</a>
                    </li>
                    <!-- Button trigger modal -->
                    <button type="button" class="reset ms-1" data-bs-toggle="modal" data-bs-target="#exampleModal">
                      Delete
                    </button>
                  </ul>

                  <!-- Modal -->
                  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title text-danger" id="exampleModalLabel">Delete</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          After Deletion data cannot be recover back!!!
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>


                          <form class="" action="/campgrounds/<%= campground._id%>?_method=DELETE" method="POST">
                            <button type="submit" class="btn btn-danger ">delete</button>
                          </form>

                        </div>
                      </div>
                    </div>
                  </div>

                </div>

<% } %> 



                <span class="float-end  mx-3"> <b>$</b> <span class="text-danger">
                    <%=campground.price%>/night
                  </span> </span>

            </h5>

            <span class="text-muted">
              <%= campground.location %>
            </span>



            <ul class="list-group list-group-flush ">

              <li class="list-group-item ">
                <span class="description">
                  <%=campground.description %>
                </span>
              </li>




            </ul>

            <span id="author" class="float-end"> Submitted by
              <a href="" class="card-link">
                <%= campground.author.username %>
              </a>
            </span>

          </div>

        </div>



      </div>





      <div class="col-md-5 mx-auto">
        <div id='map' class="map shadow"></div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item shadow-sm " id="city">
            <i class="fas fa-map-marker-alt"></i>
            <%= campground.location %>
          </li>
        </ul>




        <!-- ------------------------------  reviews  -->


        <% if(currentUser){ %>
  
  
          <button class="btn btn-outline-danger mt-5" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample"
            aria-expanded="false" aria-controls="collapseExample">
            Leave a Review
          </button>



          <div class="collapse bg-white mt-3" id="collapseExample">



            <form id="review-form" action="/campgrounds/<%= campground._id %>/reviews" class="needs-validation " method="POST"
              novalidate>

              <div class="review-panel">
                        <!-- star rating -->
                <div class="">
                  
                  <fieldset class="starability-basic mt-2 mx-auto">

                    <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1"
                      checkedaria-label="No rating." />
                    <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                    <label for="first-rate1" title="Terrible">1 star</label>
                    <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                    <label for="first-rate2" title="Not good">2 stars</label>
                    <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                    <label for="first-rate3" title="Average">3 stars</label>
                    <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                    <label for="first-rate4" title="Very good">4 stars</label>
                    <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                    <label for="first-rate5" title="Amazing">5 stars</label>
                    
                  </fieldset>
                
                    
                  
                </div>
                              <!-- review text area  -->
                <div class="">
                  
                    
                      <textarea  name="review[body]" id="text-body"  class="form-control" placeholder="Leave a comment here"  autocorrect='on' minlength='10'  required ></textarea>
                      

                    <!-- id="text-body" -->
                 
                  <div class="invalid-feedback ms-5">
                   Enter Minmum 20  Character 
                  </div>

                </div>

              </div>        
              <small class="mx-5 fs-5" id="review-feedback"></small>
              <!-- review button  -->
                <div>
                  <button class="" id="add-review-btn">Add Review</button>
                </div>
                        
            </form>
          </div>
          
       <% } %>
            <p class="fw-normal fs-4 mt-4">

              <% if(reviewflash && reviewflash.length){ %>
                <small class="text-sm-start text-danger mx-4 mb-3">
                  <%= reviewflash %> &#10003
                </small>
                <% } %>
            </p>


        <div class="mb-5">

          <% if(!campground.reviews.length){ %>
            <h5 class=" mt-5 text-center p-4 "> No Reviews</h5>

            <% } %>

              <% campground.reviews.reverse() %>


              <ul class="list-group list-group-flush">

                  <% for(let review of campground.reviews){ %>

                    <li class="list-group-item review ">

                      <span class="text-capitalize  review-user">

                        <i class='fas fa-user-circle'></i>
                        <a href="#" class="review-user">
                          <%=review.author.username %>
                        </a>

                      </span>

                      <span class="starability-result float-end mx-auto" data-rating="<%= review.rating %>">
                        Rated: <%= review.rating %> stars
                      </span>

                      <span class="mt-1 review-text">

                        <br>  
                        <%= review.body.charAt(0).toUpperCase() +review.body.slice(1) %>


                          <%if(currentUser && review.author.equals(currentUser._id)) { %>
                         <div>
                          <form class=""
                          action="/campgrounds/<%=campground._id%>/reviews/<%=review._id%>?_method=DELETE"
                          method="POST">
                          <button type="submit" class="" id="delete-review">
                            Delete
                          </button>
                        </form>

                         </div>

                            <% } %>
                      </span>

                    </li>

                    <% } %>

                </ul>


        </div>
      </div>

    
    


    </div>

 
    <!----------------------- new row started ------------------------------>



    <div class="row">
      

      



      <!-- --------------------------------------------------------- -->





    </div>



  </div>










  <script>
    const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
    const campground = <%-JSON.stringify(campground) %>
  </script>

<script src="/javascripts/validaterating.js"></script>
<script src="/javascripts/showpagemap.js"></script>
  